<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Cleaning and summarizing</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">TDA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="tda-difficulty.html">TDA Difficulty</a>
</li>
<li>
  <a href="item-difficulty.html">Item Difficulty</a>
</li>
<li>
  <a href="sample.html">Sample characteristics</a>
</li>
<li>
  <a href="data-cleaning.html">Data cleaning code</a>
</li>
<li>
  <a href="codebook-scored.html">Codebook</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/pie-lab/tda">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Cleaning and summarizing</h1>
<h4 class="date">Last updated 2021-04-27</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#load-data-and-packages">Load data and packages</a>
<ul>
<li><a href="#qualtrics-survey-responses">Qualtrics survey responses</a></li>
<li><a href="#scoring-keys">Scoring keys</a></li>
</ul></li>
<li><a href="#score-data-new">Score data new</a></li>
<li><a href="#data-for-publication">Data for publication</a>
<ul>
<li><a href="#demographics">Demographics</a></li>
<li><a href="#correct-or-incorrect">Correct or incorrect</a></li>
<li><a href="#response-option">Response option</a></li>
</ul></li>
</ul>
</div>

<div id="load-data-and-packages" class="section level1">
<h1>Load data and packages</h1>
<pre class="r"><code>library(here) # for engaging with working environment
library(rio) # for importing excel files
library(tidyverse) # for data cleaning and manipulation
library(psych) # for scoring multiple choice items
library(R.utils) # just for the insert() function</code></pre>
<div id="qualtrics-survey-responses" class="section level2">
<h2>Qualtrics survey responses</h2>
<p>The excel files contain raw data exported from Qualtrics. The first row of this file contains variable names, but rows 2 and 3 contain meta data. To account, we first load in all data as a “names” data frame and then data starting at row 4, for the raw data.</p>
<pre class="r"><code># read in form A (Prolific)
formA_names = read_csv(
  here(&quot;data/Form+A_Prolific_April+2,+2021_15.27.csv&quot;))

formA = read_csv(
  here(&quot;data/Form+A_Prolific_April+2,+2021_15.27.csv&quot;), 
  col_names = F, skip = 3)

names(formA) = names(formA_names)
rm(formA_names)

# read in form A (MTurk)
formA_names = read_csv(
  here(&quot;data/Form A_April 2, 2021_15.41.numeric.csv&quot;))

formA2 = read_csv(
  here(&quot;data/Form A_April 2, 2021_15.41.numeric.csv&quot;), 
  col_names = F, skip = 3)

names(formA2) = names(formA_names)
rm(formA_names)

formA = full_join(formA, formA2)
rm(formA2)

# read in form B (Prolific)
formB_names = read_csv(
  here(&quot;data/Form+B_Prolific_April+2,+2021_15.27.csv&quot;))

formB = read_csv(
  here(&quot;data/Form+B_Prolific_April+2,+2021_15.27.csv&quot;), 
  col_names = F, skip = 3)

names(formB) = names(formB_names)
rm(formB_names)


# read in form B (MTurk)
formB_names = read_csv(
  here(&quot;data/Form B_April 2, 2021_15.44.numeric.csv&quot;))

formB2 = read_csv(
  here(&quot;data/Form B_April 2, 2021_15.44.numeric.csv&quot;), 
  col_names = F, skip = 3)

names(formB2) = names(formB_names)
rm(formB_names)

formB = full_join(formB, formB2)
rm(formB2)

# read in form C (Prolific)
formC_names = read_csv(
  here(&quot;data/Form+C_April+16,+2021_17.21.csv&quot;))

formC = read_csv(
  here(&quot;data/Form+C_April+16,+2021_17.21.csv&quot;), 
  col_names = F, skip = 3)

names(formC) = names(formC_names)
rm(formC_names)</code></pre>
<p>In forms A and B, variable names composed solely of numbers (e.g., 20001) refer to the specific variable number as included in the dictionary. These must be prefaced by <code>q_</code> for readability.</p>
<pre class="r"><code>names(formA) = str_replace(names(formA), # look in this vector of strings
                           &quot;(^)([0-9]*$)&quot;, #match two parts. part 1: beginning of string, second part: digits 0 or more times and then the string ends
                           &quot;q_\\2&quot;) # replace with q_ followed by the second part of the match

names(formB) = str_replace(names(formB), 
                           &quot;(^)([0-9]*$)&quot;, 
                           &quot;q_\\2&quot;) 

names(formC) = str_replace(names(formC), 
                           &quot;^Q&quot;, 
                           &quot;q_&quot;) 

# an additional error in form C -- some variable names were coded with only the last 4 digits (i.e., missing the first &quot;2&quot;)
names(formC) = str_replace(names(formC), 
                           &quot;(q_)(\\d{4}$)&quot;, &quot;\\12\\2&quot;)</code></pre>
<p>Remove participants without valid Prolific or MTurk IDs.</p>
<pre class="r"><code>formA = formA %&gt;%
  filter(!is.na(mTurkCode) | str_length(PROLIFIC_PID) &gt; 3)
formB = formB %&gt;%
  filter(!is.na(mTurkCode) | str_length(PROLIFIC_PID) &gt; 3)
formC = formC %&gt;%
  filter(str_length(PROLIFIC_PID) &gt; 3)</code></pre>
</div>
<div id="scoring-keys" class="section level2">
<h2>Scoring keys</h2>
<pre class="r"><code>keyA = read_csv(here(&quot;keys/key_A.csv&quot;))
keyB = read_csv(here(&quot;keys/key_B.csv&quot;))
keyC = import(here(&quot;keys/key_C.xlsx&quot;), sheet = 1)</code></pre>
<p>Variable names composed solely of numbers (e.g., 1) refer to the response choice number as presented to participants. These must be prefaced by <code>R_</code> for readability.</p>
<pre class="r"><code>names(keyA) = str_replace(names(keyA), 
                           &quot;(^)([0-9]{1}$)&quot;, 
                           &quot;R_\\2&quot;) 

names(keyB) = str_replace(names(keyB), 
                           &quot;(^)([0-9]{1}$)&quot;, 
                           &quot;R_\\2&quot;) 

names(keyC) = str_replace(names(keyC), 
                           &quot;(^)([0-9]{1}$)&quot;, 
                           &quot;R_\\2&quot;) 
keyC = rename(keyC, X1 = .)</code></pre>
<p>The <code>Key</code> column indicates the position of the correct response. We create a key vector that contains the value of the correct response, not the position.</p>
<pre class="r"><code>create_key = function(keydf){
  # select only response variables and concatonate by row into vectors
  keydf$response_vector = keydf %&gt;%
    select(starts_with(&quot;R&quot;)) %&gt;%
    pmap(~c(..1, ..2, ..3, ..4, ..5, ..6))

  # map across response vectors and key positions to pull out correct answer
  keydf = keydf %&gt;%
    mutate(answer = map2_chr(response_vector, Key,
                         ~.x[.y]))
  return(keydf)
}

keyA = create_key(keyA) %&gt;%
  mutate(form = &quot;A&quot;)
keyB = create_key(keyB) %&gt;%
  mutate(form = &quot;B&quot;)
keyC = create_key(keyC) %&gt;%
  group_by(Stimulus) %&gt;%
  mutate(form = ifelse(row_number() == 1, &quot;C&quot;, &quot;D&quot;)) %&gt;%
  ungroup()</code></pre>
<p>Merge keys together.</p>
<pre class="r"><code>masterKey = keyA %&gt;%
  full_join(keyB) %&gt;%
  full_join(keyC) %&gt;%
  select(X1:Key, answer, form) %&gt;%
  rename(item = X1)</code></pre>
</div>
</div>
<div id="score-data-new" class="section level1">
<h1>Score data new</h1>
<p>First, we merge all raw datasets.</p>
<pre class="r"><code>all_data = formA %&gt;%
  full_join(formB) %&gt;%
  full_join(formC)</code></pre>
<pre class="r"><code>alldata_scored = score.multiple.choice(
  key = masterKey$Key, 
  data = all_data[, masterKey$item], 
  score = FALSE)</code></pre>
<p>Remove items which were mistakes (see key_C, sheet entitled linking C to A and B.)</p>
<pre class="r"><code>remove_items = c(
    &quot;q_21148&quot;,
    &quot;q_22573&quot;,
    &quot;q_22496&quot;,
    &quot;q_20052&quot;,
    &quot;q_21409&quot;,
    &quot;q_22068&quot;,
    &quot;q_22169&quot;,
    &quot;q_21911&quot;,
    &quot;q_21185&quot;,
    &quot;q_21288&quot;,
    &quot;q_20790&quot;,
    &quot;q_20033&quot;,
    &quot;q_24285&quot;,
    &quot;q_23402&quot;,
    &quot;q_24824&quot;,
    &quot;q_23044&quot;,
    &quot;q_25399&quot;,
    &quot;q_23847&quot;,
    &quot;q_23990&quot;,
    &quot;q_23485&quot;,
    &quot;q_24709&quot;,
    &quot;q_23602&quot;,
    &quot;q_24676&quot;,
    &quot;q_25281&quot;,
    &quot;q_23456&quot;)

remove_which = which(masterKey$item %in% remove_items)

alldata_scored = alldata_scored[, -remove_which]
masterKey = filter(masterKey, !(item %in% remove_items))
all_data = select(all_data, -all_of(remove_items))</code></pre>
</div>
<div id="data-for-publication" class="section level1">
<h1>Data for publication</h1>
<div id="demographics" class="section level2">
<h2>Demographics</h2>
<pre class="r"><code>demo = all_data %&gt;%
  mutate(comb_id = case_when(
    !is.na(prolificID) ~ prolificID,
    !is.na(mTurkCode) ~ as.character(mTurkCode),
    TRUE ~ NA_character_)) %&gt;%
  mutate(source = case_when(
    !is.na(prolificID) ~ &quot;Prolific&quot;,
    !is.na(mTurkCode) ~ &quot;MTurk&quot;,
    TRUE ~ NA_character_)) %&gt;%
  mutate(row = row_number() + 1000) %&gt;%
  group_by(comb_id) %&gt;%
  mutate(row = min(row)) %&gt;%
  mutate(PID = paste0(&quot;R&quot;, row)) %&gt;%
  ungroup() %&gt;%
  rename(duration = `Duration (in seconds)`) %&gt;%
  mutate(
    english_cat = case_when(
      english == 1 ~ &quot;Very well (fluent/native)&quot;,
      english == 2 ~ &quot;Well&quot;,
      english == 3 ~ &quot;Not well&quot;,
      english == 4 ~ &quot;Not at all (Need translation)&quot;,
      TRUE ~ NA_character_),
    growup_cat = case_when(
      growup == 1 ~ &quot;United States of America&quot;,
      growup == 2 ~ &quot;Outside of the US&quot;),
    live_cat = case_when(
      live == 1 ~ &quot;Yes&quot;,
      live == 2 ~ &quot;No&quot;),
    state = recode(states, 
                    !!!c(state.name[1:8], &quot;District of Columbia&quot;, state.name[9:50])
                    ),
    sex = case_when(
      sex == 1 ~ &quot;Male&quot;,
      sex == 2 ~ &quot;Female&quot;,
      sex == 3 ~ &quot;Other&quot;,
      sex == 4 ~ &quot;Prefer not to say&quot;),
    edu = case_when(
      edu == 0 ~ &quot;Less than 12 years&quot;, 
      edu == 1 ~  &quot;High school grad/GED&quot;,
      edu == 2 ~  &quot;Currently in college/university&quot;,
      edu == 3 ~  &quot;Some college/university, but did not graduate&quot;,
      edu == 4 ~  &quot;Associate degree (2 yr)&quot;,
      edu == 5 ~  &quot;College/university degree (4 yr)&quot;,
      edu == 6 ~  &quot;Currently in grad/professional school&quot;,
      edu == 7 ~  &quot;Grad/professional degree&quot;),
    ethnic = case_when(
     ethnic == 1 ~ &quot;American Indian/Alaskan Native&quot;,
     ethnic == 2 ~ &quot;Asian&quot;,
     ethnic == 3 ~ &quot;Black&quot;,
     ethnic == 4 ~ &quot;Hispanic&quot;,
     ethnic == 5 ~ &quot;White&quot;,
     ethnic == 6 ~ &quot;Mixed (two or more)&quot;,
     ethnic == 7 ~ &quot;Other&quot;),
    hhinc = case_when(
      hhinc == 1 ~ &quot;&lt; 20K&quot;,
      hhinc == 2 ~ &quot;20K-40K&quot;,
      hhinc == 3 ~ &quot;40K-60K&quot;,
      hhinc == 4 ~ &quot;60K-80K&quot;,
      hhinc == 5 ~ &quot;80K-100K&quot;,
      hhinc == 6 ~ &quot;100K-120K&quot;,
      hhinc == 7 ~ &quot;120K-150K&quot;,
      hhinc == 8 ~ &quot;150K-200K&quot;,
      hhinc == 9 ~ &quot;200K-250K&quot;,
      hhinc == 10 ~ &quot;250K-350K&quot;,
      hhinc == 11 ~ &quot;350K-500K&quot;,
      hhinc == 12 ~ &quot;&gt; 500K&quot;,
      hhinc == 13 ~ &quot;Prefer not to say&quot;))</code></pre>
<p>Participants are excluded from analyses if they * complete the survey in less than 3 minutes (180 seconds), * don’t speak fluent English, * grew up outside the US, or * are currently living outside the US.</p>
<pre class="r"><code>demo = demo %&gt;%
  mutate(included = case_when(
    duration &lt; 180 ~ &quot;No&quot;,
    english &gt; 2 ~ &quot;No&quot;,
    growup == 2 ~ &quot;No&quot;,
    live == 2 ~ &quot;No&quot;,
    TRUE ~ &quot;Yes&quot;
  ))</code></pre>
<p>163 rows are excluded on this basis.</p>
<pre class="r"><code>demo = demo %&gt;%
  select(PID, source, StartDate, duration, english_cat, growup_cat, live_cat, state, age, sex, edu, ethnic, hhinc, included)

names(demo) = str_remove(names(demo), &quot;_cat&quot;)

demo$prop_correct &lt;- alldata_scored %&gt;% rowMeans(na.rm = T)</code></pre>
</div>
<div id="correct-or-incorrect" class="section level2">
<h2>Correct or incorrect</h2>
<pre class="r"><code>alldata_scored_df = as.data.frame(alldata_scored)
data_scored = cbind(demo, alldata_scored)
write_csv(data_scored, 
          file = here(&quot;data/TDA_data_scored.csv&quot;))</code></pre>
</div>
<div id="response-option" class="section level2">
<h2>Response option</h2>
<p>First we create a vector for each item that specifies the new labels. All distractors take the form <code>R1</code> through <code>R5</code>. <code>Ans</code> (for the correct answer) is then inserted in the location of the correct response.</p>
<pre class="r"><code>masterKey = masterKey %&gt;%
  mutate(relevel = map(Key, 
                       ~insert(c(&quot;R1&quot;,&quot;R2&quot;,&quot;R3&quot;,&quot;R4&quot;,&quot;R5&quot;,&quot;I don&#39;t know&quot;, &quot;None of these&quot;), 
                              at = .x, &quot;Ans&quot;)))</code></pre>
<p>Next we create a function that takes a vector of responses and the name of the item. The item name is used to identify the correct vector created in the previous code chunk. This is applied using the recode function and the new vector is returned.</p>
<pre class="r"><code>relevel_fun = function(response, item_name){
  relevel_vector = masterKey$relevel[masterKey$item == item_name][[1]]
  new_vector = recode(response, !!!relevel_vector)
  return(new_vector)
}</code></pre>
<p>We select just the TDA items and assign each row a unique number. This will help ensure all the responses end up in the correct place when we spread later. Then we stack questions and nest, to create a separate data frame for each item, containing a column called “response.”</p>
<pre class="r"><code>raw_items = all_data %&gt;%
  select(starts_with(&quot;q_&quot;)) %&gt;%
  mutate(row = row_number()) %&gt;%
  gather(&quot;item&quot;, &quot;response&quot;, starts_with(&quot;q_&quot;)) %&gt;%
  group_by(item) %&gt;%
  nest()

# what does this look like
head(raw_items)</code></pre>
<pre><code>## # A tibble: 6 x 2
## # Groups:   item [6]
##   item    data                
##   &lt;chr&gt;   &lt;list&gt;              
## 1 q_20001 &lt;tibble [3,540 × 2]&gt;
## 2 q_20002 &lt;tibble [3,540 × 2]&gt;
## 3 q_20003 &lt;tibble [3,540 × 2]&gt;
## 4 q_20004 &lt;tibble [3,540 × 2]&gt;
## 5 q_20005 &lt;tibble [3,540 × 2]&gt;
## 6 q_20006 &lt;tibble [3,540 × 2]&gt;</code></pre>
<pre class="r"><code>head(raw_items$data[[1]]) </code></pre>
<pre><code>## # A tibble: 6 x 2
##     row response
##   &lt;int&gt;    &lt;dbl&gt;
## 1     1        3
## 2     2       NA
## 3     3       NA
## 4     4       NA
## 5     5       NA
## 6     6       NA</code></pre>
<pre class="r"><code>table(raw_items$data[[1]]$response) </code></pre>
<pre><code>## 
##  1  2  3  4  5  6  7  8 
##  1  1  5  1 20  1  6  2</code></pre>
<p>Iterating across items, we apply the <code>relevel</code> function to the dataset, which replaces numeric values with the appropriate categorical value (Ans, R1:R5, I don’t know, and None of these)</p>
<pre class="r"><code>recoded_items = raw_items %&gt;%
  mutate(data = map2(data, item, 
                     ~mutate(.x, response = relevel_fun(response, .y)))) 

# what does this look like
head(recoded_items$data[[1]]) </code></pre>
<pre><code>## # A tibble: 6 x 2
##     row response
##   &lt;int&gt; &lt;chr&gt;   
## 1     1 R3      
## 2     2 &lt;NA&gt;    
## 3     3 &lt;NA&gt;    
## 4     4 &lt;NA&gt;    
## 5     5 &lt;NA&gt;    
## 6     6 &lt;NA&gt;</code></pre>
<pre class="r"><code>table(recoded_items$data[[1]]$response) </code></pre>
<pre><code>## 
##           Ans  I don&#39;t know None of these            R1            R2 
##            20             6             2             1             1 
##            R3            R4            R5 
##             5             1             1</code></pre>
<p>We unnest the data frames and spread back into the original format, ending with arrange to ensure the data are in the same rows as before.</p>
<pre class="r"><code>recoded_items = recoded_items %&gt;% 
  unnest(cols = c(data)) %&gt;%
  spread(item, response) %&gt;% 
  arrange(row) %&gt;% 
  select(-row)</code></pre>
<p>Finally, we connect these responses to the demographic variables and save.</p>
<pre class="r"><code>data_recode = cbind(demo, recoded_items)
write_csv(data_recode, 
          file = here(&quot;data/TDA_data_recoded.csv&quot;))</code></pre>
<p>We also save a shortened version of the master key object.</p>
<pre class="r"><code>masterKey %&gt;%
  select(item, answer, form) %&gt;%
  rename(adjective = answer) %&gt;%
  write_csv(file = here(&quot;data/masterkey.csv&quot;))</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
